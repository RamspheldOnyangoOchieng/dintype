                                                     pg_get_functiondef                                                     
----------------------------------------------------------------------------------------------------------------------------
 CREATE OR REPLACE FUNCTION public.handle_new_user()                                                                       +
  RETURNS trigger                                                                                                          +
  LANGUAGE plpgsql                                                                                                         +
  SECURITY DEFINER                                                                                                         +
 AS $function$                                                                                                             +
 BEGIN                                                                                                                     +
   INSERT INTO public.profiles (id, email, username, created_at)                                                           +
   VALUES (new.id, new.email, COALESCE(new.raw_user_meta_data->>'username', split_part(new.email, '@', 1)), new.created_at)+
   ON CONFLICT (id) DO NOTHING;                                                                                            +
                                                                                                                           +
   INSERT INTO public.user_tokens (user_id, balance)                                                                       +
   VALUES (new.id, 100)                                                                                                    +
   ON CONFLICT (user_id) DO NOTHING;                                                                                       +
                                                                                                                           +
   RETURN new;                                                                                                             +
 END;                                                                                                                      +
 $function$                                                                                                                +
 
(1 row)

